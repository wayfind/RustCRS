# Claude Console é¢„é…ç½®æµ‹è¯•è„šæœ¬ä½¿ç”¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

è„šæœ¬å·²é¢„é…ç½®å¥½ Claude Console å‡­æ®ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œï¼

### ç¬¬ä¸€æ­¥ï¼šç¡®ä¿åç«¯è¿è¡Œ

```bash
cd /mnt/d/prj/claude-relay-service
make rust-dev
```

### ç¬¬äºŒæ­¥ï¼šè¿è¡Œæµ‹è¯•è„šæœ¬

```bash
# å¿«é€Ÿæµ‹è¯• - 1åˆ†é’Ÿ
bash test-claudeconsole-preconfigured.sh 60

# æ ‡å‡†æµ‹è¯• - 5åˆ†é’Ÿï¼ˆé»˜è®¤ï¼‰
bash test-claudeconsole-preconfigured.sh 300

# æ·±åº¦æµ‹è¯• - 10åˆ†é’Ÿ
bash test-claudeconsole-preconfigured.sh 600
```

## ğŸ“‹ è„šæœ¬åŠŸèƒ½

### é¢„é…ç½®ä¿¡æ¯

è„šæœ¬å·²å†…ç½®ä»¥ä¸‹é…ç½®ï¼š
- âœ… Claude Console ç«¯ç‚¹: `https://us3.pincc.ai/api`
- âœ… Session Token: `cr_022dc9fc...`
- âœ… æ¨¡å‹: `claude-3-5-sonnet-20241022`
- âœ… Max Tokens: 100

### ä¸¤ç§æµ‹è¯•æ¨¡å¼

è„šæœ¬å¯åŠ¨æ—¶ä¼šè¯¢é—®æµ‹è¯•æ¨¡å¼ï¼š

**æ¨¡å¼ 1: é€šè¿‡æœ¬åœ° Rust åç«¯ï¼ˆæ¨èï¼‰**
- æµ‹è¯•å®Œæ•´çš„ä¸­è½¬æµç¨‹
- éªŒè¯ç»Ÿè®¡æ•°æ®å‡†ç¡®æ€§
- éœ€è¦å…ˆåˆ›å»º API Key

**æ¨¡å¼ 2: ç›´æ¥æµ‹è¯• Claude Console ç«¯ç‚¹**
- ç›´æ¥éªŒè¯å‡­æ®æœ‰æ•ˆæ€§
- è·³è¿‡æœ¬åœ°åç«¯
- ä¸éœ€è¦ API Key

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: éªŒè¯å‡­æ®æœ‰æ•ˆæ€§ï¼ˆæ¨èå…ˆåšï¼‰

```bash
bash test-claudeconsole-preconfigured.sh 60
# é€‰æ‹©: n (ä¸é€šè¿‡æœ¬åœ°åç«¯)
# ç›®çš„: å¿«é€ŸéªŒè¯ session_token æ˜¯å¦æœ‰æ•ˆ
```

### åœºæ™¯ 2: å®Œæ•´åŠŸèƒ½æµ‹è¯•

**å‡†å¤‡å·¥ä½œ**:
1. è®¿é—® http://localhost:8080/admin-next
2. ç™»å½•ç®¡ç†åå°
3. æ·»åŠ  Claude Console è´¦æˆ·ï¼š
   - åç§°: "æµ‹è¯•è´¦æˆ·"
   - å¹³å°: claudeconsole
   - Session Token: `cr_022dc9fc7f8fff3b5d957fea7137cde70d5b1a2a9a19905d21994ded34cfbdcc`
   - è‡ªå®šä¹‰ç«¯ç‚¹: `https://us3.pincc.ai/api`
4. åˆ›å»º API Key å¹¶ç»‘å®šåˆ°è¯¥è´¦æˆ·
5. å¤åˆ¶ç”Ÿæˆçš„ API Key (å¦‚: `cr_xxxx...`)

**è¿è¡Œæµ‹è¯•**:
```bash
bash test-claudeconsole-preconfigured.sh 300
# é€‰æ‹©: Y (é€šè¿‡æœ¬åœ°åç«¯)
# è¾“å…¥: æ‚¨åˆ›å»ºçš„ API Key
```

### åœºæ™¯ 3: é•¿æ—¶é—´å‹åŠ›æµ‹è¯•

```bash
# åå°è¿è¡Œ 30 åˆ†é’Ÿæµ‹è¯•
nohup bash test-claudeconsole-preconfigured.sh 1800 > logs/test-30min.log 2>&1 &

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f logs/test-30min.log
```

## ğŸ“Š æµ‹è¯•è¾“å‡ºç¤ºä¾‹

### è¿è¡Œè¿‡ç¨‹è¾“å‡º

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   Claude Console è´¦æˆ·é¢„é…ç½®æµ‹è¯•                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ æµ‹è¯•é…ç½®:
  - ç«¯ç‚¹: https://us3.pincc.ai/api
  - Token: cr_022dc9fc7f8fff3b...907cbf
  - æœ¬åœ°ç«¯ç‚¹: http://localhost:8080/api/v1/messages
  - æ¨¡å‹: claude-3-5-sonnet-20241022
  - æµ‹è¯•æ—¶é•¿: 60 ç§’ (1.0 åˆ†é’Ÿ)
  - è¯·æ±‚é—´éš”: 3 ç§’
  - é¢„è®¡è¯·æ±‚æ•°: 20

ğŸ” æ£€æŸ¥åç«¯çŠ¶æ€...
âœ… åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ

æ˜¯å¦é€šè¿‡æœ¬åœ° Rust åç«¯æµ‹è¯•ï¼Ÿ(Y/n): Y
ğŸ”„ å°†é€šè¿‡æœ¬åœ° Rust åç«¯è¿›è¡Œæµ‹è¯•

...

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯·æ±‚ #1
â”‚ æ—¶é—´: 14:30:25
â”‚ å·²è¿è¡Œ: 0s / å‰©ä½™: 60s
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
âœ… æˆåŠŸ - è€—æ—¶: 1.234s
   Input: 18 tokens, Output: 42 tokens
   é—®é¢˜: What is 42 plus 17? Give me just the answer.
   å›ç­”: 59

ğŸ“Š å½“å‰ç»Ÿè®¡:
   æˆåŠŸç‡: 100.00% (1/1)
   å¹³å‡ Token: In=18.0, Out=42.0
```

### æœ€ç»ˆæŠ¥å‘Š

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     æœ€ç»ˆæµ‹è¯•æŠ¥å‘Š                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š æ€»ä½“ç»Ÿè®¡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  æ€»è¯·æ±‚æ•°:     20
  æˆåŠŸ:         20
  å¤±è´¥:         0
  æˆåŠŸç‡:       100.00%

ğŸ¯ Token ä½¿ç”¨
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  æ€» Input:     360 tokens
  æ€» Output:    840 tokens
  æ€»è®¡:         1200 tokens
  å¹³å‡ Input:   18.0 tokens/è¯·æ±‚
  å¹³å‡ Output:  42.0 tokens/è¯·æ±‚

â±ï¸  æ€§èƒ½
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  è®¡åˆ’æ—¶é•¿:     60 ç§’
  å®é™…æ—¶é•¿:     60 ç§’
  è¯·æ±‚é—´éš”:     3 ç§’

âœ¨ è´¨é‡è¯„ä¼°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  æˆåŠŸç‡:       âœ… ä¼˜ç§€ (100.00%)
  ç¨³å®šæ€§:       âœ… ç¨³å®š (0 ä¸ªé”™è¯¯)

ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  è¯¦ç»†æŠ¥å‘Š:     logs/test-report-20251106-143125.md
  æˆåŠŸæ—¥å¿—:     logs/test-success.log
```

## ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶

æµ‹è¯•å®Œæˆåä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

```
logs/
â”œâ”€â”€ test-report-20251106-143125.md  # Markdown æ ¼å¼è¯¦ç»†æŠ¥å‘Š
â”œâ”€â”€ test-success.log                # æˆåŠŸè¯·æ±‚æ—¥å¿—
â””â”€â”€ test-errors.log                 # é”™è¯¯æ—¥å¿—ï¼ˆå¦‚æœ‰é”™è¯¯ï¼‰
```

### æŸ¥çœ‹æŠ¥å‘Š

```bash
# æŸ¥çœ‹æœ€æ–°æŠ¥å‘Š
cat logs/test-report-*.md | tail -100

# æŸ¥çœ‹æˆåŠŸæ—¥å¿—
tail -20 logs/test-success.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
cat logs/test-errors.log
```

## ğŸ” éªŒè¯ç»Ÿè®¡æ•°æ®ï¼ˆé€šè¿‡æœ¬åœ°åç«¯æµ‹è¯•æ—¶ï¼‰

### 1. æŸ¥çœ‹ API Key ä½¿ç”¨ç»Ÿè®¡

```bash
# éœ€è¦æ›¿æ¢ <your_key_id> ä¸ºå®é™…çš„ API Key ID
docker exec redis-dev redis-cli GET "api_key_usage:<your_key_id>" | jq '.'
```

é¢„æœŸè¾“å‡ºï¼š
```json
{
  "request_count": 20,
  "input_tokens": 360,
  "output_tokens": 840,
  "cost": 0.012
}
```

### 2. æŸ¥çœ‹è´¦æˆ·ä½¿ç”¨ç»Ÿè®¡

```bash
# éœ€è¦æ›¿æ¢ <account_id> å’Œæ—¥æœŸ
docker exec redis-dev redis-cli GET "usage:account:<account_id>:2025-11-06" | jq '.'
```

é¢„æœŸè¾“å‡ºï¼š
```json
{
  "count": 20,
  "input_tokens": 360,
  "output_tokens": 840
}
```

### 3. ä¸€è‡´æ€§æ£€æŸ¥

ç»Ÿè®¡æ•°æ®åº”è¯¥æ»¡è¶³ï¼š
- âœ… API Key è¯·æ±‚æ•° = è´¦æˆ·è¯·æ±‚æ•° = æµ‹è¯•è„šæœ¬æŠ¥å‘Šçš„æˆåŠŸæ•°
- âœ… API Key tokens = è´¦æˆ· tokens = æµ‹è¯•è„šæœ¬æŠ¥å‘Šçš„ tokens
- âœ… æ— æ•°æ®ä¸¢å¤±æˆ–é‡å¤è®¡æ•°

## ğŸ’¡ é«˜çº§ç”¨æ³•

### 1. è‡ªå®šä¹‰æµ‹è¯•å‚æ•°

ç¼–è¾‘è„šæœ¬ä¸­çš„é…ç½®åŒºåŸŸï¼š

```bash
# ä¿®æ”¹è¯·æ±‚é—´éš”ï¼ˆé»˜è®¤3ç§’ï¼‰
REQUEST_INTERVAL=1  # æ¯ç§’ä¸€ä¸ªè¯·æ±‚

# ä¿®æ”¹ max_tokensï¼ˆé»˜è®¤100ï¼‰
MAX_TOKENS=200

# ä¿®æ”¹æ¨¡å‹
MODEL="claude-3-opus-20240229"
```

### 2. æ‰¹é‡æµ‹è¯•ä¸åŒæ—¶é•¿

```bash
# åˆ›å»ºæ‰¹é‡æµ‹è¯•è„šæœ¬
cat > batch-test.sh << 'EOF'
#!/bin/bash
for duration in 60 180 300 600; do
  echo "å¼€å§‹ ${duration} ç§’æµ‹è¯•..."
  bash test-claudeconsole-preconfigured.sh $duration
  echo "ç­‰å¾… 30 ç§’åç»§ç»­..."
  sleep 30
done
EOF

chmod +x batch-test.sh
bash batch-test.sh
```

### 3. ç›‘æ§ + æµ‹è¯•å¹¶è¡Œ

```bash
# ç»ˆç«¯ 1: ç›‘æ§åç«¯æ—¥å¿—
tail -f logs/test-session.log | grep -E "session_token|usage|error"

# ç»ˆç«¯ 2: è¿è¡Œæµ‹è¯•
bash test-claudeconsole-preconfigured.sh 300

# ç»ˆç«¯ 3: ç›‘æ§ Redis ç»Ÿè®¡ï¼ˆéœ€è¦çŸ¥é“ key IDï¼‰
watch -n 5 "docker exec redis-dev redis-cli GET 'api_key_usage:<your_key_id>' | jq '.'"
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å‡­æ®æœ‰æ•ˆæ€§**: å¦‚æœ session_token è¿‡æœŸï¼Œéœ€è¦æ›´æ–°è„šæœ¬ä¸­çš„ `ANTHROPIC_AUTH_TOKEN`

2. **é€Ÿç‡é™åˆ¶**: æ³¨æ„ä¸è¦è¶…è¿‡ Claude Console çš„é€Ÿç‡é™åˆ¶ï¼Œå»ºè®®è¯·æ±‚é—´éš” â‰¥ 3ç§’

3. **æˆæœ¬æ§åˆ¶**: æ¯ä¸ªè¯·æ±‚ä¼šæ¶ˆè€— tokensï¼Œé•¿æ—¶é—´æµ‹è¯•ä¼šäº§ç”Ÿè´¹ç”¨

4. **åå°è¿è¡Œ**: é•¿æ—¶é—´æµ‹è¯•å»ºè®®ä½¿ç”¨ `nohup` åå°è¿è¡Œ

5. **æ—¥å¿—æ¸…ç†**: å®šæœŸæ¸…ç† `logs/` ç›®å½•é¿å…å ç”¨è¿‡å¤šç£ç›˜ç©ºé—´

## ğŸ†˜ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: åç«¯æœªè¿è¡Œ

**é”™è¯¯**: `âŒ åç«¯æœåŠ¡æœªè¿è¡Œ`

**è§£å†³**:
```bash
cd /mnt/d/prj/claude-relay-service
make rust-dev
```

### é—®é¢˜ 2: Session Token æ— æ•ˆ

**é”™è¯¯**: `authentication_error: invalid x-api-key`

**åŸå› **: session_token å¯èƒ½å·²è¿‡æœŸ

**è§£å†³**: æ›´æ–°è„šæœ¬ä¸­çš„ `ANTHROPIC_AUTH_TOKEN`

### é—®é¢˜ 3: å…¨éƒ¨è¯·æ±‚å¤±è´¥

**æ£€æŸ¥**:
```bash
# 1. æ£€æŸ¥åç«¯å¥åº·
curl http://localhost:8080/health

# 2. æ£€æŸ¥ Redis
docker exec redis-dev redis-cli ping

# 3. æŸ¥çœ‹åç«¯æ—¥å¿—
tail -50 logs/test-session.log
```

### é—®é¢˜ 4: ç»Ÿè®¡æ•°æ®ä¸ä¸€è‡´

**å¯èƒ½åŸå› **:
- Redis è¿æ¥é—®é¢˜
- å¹¶å‘å†™å…¥å†²çª
- ç»Ÿè®¡æ›´æ–°å¤±è´¥

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—ä¸­çš„ç»Ÿè®¡æ›´æ–°
grep "usage" logs/test-session.log | tail -20
```

## ğŸ‰ æˆåŠŸæ ‡å‡†

ä¸€æ¬¡æˆåŠŸçš„æµ‹è¯•åº”è¯¥æ»¡è¶³ï¼š

âœ… **åŠŸèƒ½æ€§**:
- æˆåŠŸç‡ > 95%
- æ‰€æœ‰è¯·æ±‚æ­£å¸¸å“åº”
- Token ç»Ÿè®¡å‡†ç¡®

âœ… **æ€§èƒ½**:
- å¹³å‡å“åº”æ—¶é—´ < 3ç§’
- æ— è¶…æ—¶é”™è¯¯
- å†…å­˜ä½¿ç”¨ç¨³å®š

âœ… **æ•°æ®å‡†ç¡®æ€§**:
- API Key å’Œè´¦æˆ·ç»Ÿè®¡ä¸€è‡´
- Token è®¡æ•°å‡†ç¡®
- æ— æ•°æ®ä¸¢å¤±

---

**è„šæœ¬ä½ç½®**: `/mnt/d/prj/claude-relay-service/test-claudeconsole-preconfigured.sh`
**æ”¯æŒ**: å¦‚æœ‰é—®é¢˜ï¼ŒæŸ¥çœ‹ `logs/test-errors.log` å’Œ `logs/backend.log`
