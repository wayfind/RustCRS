# Issue 追踪系统使用指南

**更新时间**: 2025-11-02
**系统版本**: 2.0 - 三文件分离式

---

## 📁 系统架构

### 三文件设计理念

```
claudedocs/
├─ issue-todo.md     📋 待解决问题池 (状态: 🔴 待修复 / ⏸️ 暂缓)
├─ issue-doing.md    🟡 当前工作批次 (状态: 🟡 进行中)
└─ issue-done.md     ✅ 已完成归档 (状态: ✅ 已修复)
```

### 问题生命周期

```
┌─────────────────────────────────────────────────────────┐
│  1. 发现问题 (UI 漫游测试/集成测试/用户反馈)            │
└────────────────┬────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────┐
│  2. 记录到 issue-todo.md                                │
│     - 填写基本信息                                      │
│     - 进行根因分析（5次为什么）                         │
│     - 识别依赖关系                                      │
│     - 标记状态: 🔴 待修复 或 ⏸️ 暂缓                   │
└────────────────┬────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────┐
│  3. 选择批次 (从 issue-todo.md)                         │
│     - 优先选择底层问题（阻塞问题数多）                  │
│     - 选择 ≤5 个相关问题                                │
│     - 确认无未解决的依赖                                │
└────────────────┬────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────┐
│  4. 移动到 issue-doing.md                               │
│     - 复制问题完整信息                                  │
│     - 添加修复进度清单                                  │
│     - 从 issue-todo.md 删除                             │
└────────────────┬────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────┐
│  5. 修复问题 (在 issue-doing.md 中跟踪)                 │
│     - 编写失败的集成测试                                │
│     - 修复 Rust 代码                                    │
│     - 验证测试通过                                      │
│     - 更新接口文档                                      │
│     - UI 回归测试                                       │
└────────────────┬────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────┐
│  6. 完成修复                                            │
│     - 复制到 issue-done.md（添加修复方案）             │
│     - 从 issue-doing.md 删除                            │
│     - 解除被阻塞问题（更新 issue-todo.md）             │
└────────────────┬────────────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────┐
│  7. 归档 (issue-done.md)                                │
│     - 知识库积累                                        │
│     - 经验总结                                          │
│     - 供未来参考                                        │
└─────────────────────────────────────────────────────────┘
```

---

## 🔑 核心特性

### 1. 根因分析机制

**5次为什么方法**:
```
问题: 账户列表加载慢

为什么 1: Redis 查询慢
为什么 2: 连接数不足
为什么 3: 连接未正确释放
为什么 4: 错误处理路径缺少释放逻辑
为什么 5: 未使用 Rust RAII 模式 ← 根本原因

根因类型: 🏗️ 架构问题
```

**根因类型分类**:
- 🏗️ 架构设计问题
- 🔧 实现错误
- 📊 数据结构问题
- 🔌 接口不一致
- ⚡ 性能瓶颈
- 🔒 安全漏洞
- 📚 缺失功能

### 2. 依赖树管理

**依赖关系**:
```
ISSUE-010 (底层问题) 🔴 P0
  ├─ 阻塞 → ISSUE-001 (表层问题 1) ⏸️ 暂缓
  ├─ 阻塞 → ISSUE-005 (表层问题 2) ⏸️ 暂缓
  └─ 阻塞 → ISSUE-008 (表层问题 3) ⏸️ 暂缓

修复 ISSUE-010 后:
  → ISSUE-001, ISSUE-005, ISSUE-008 自动解除暂缓
  → 可以移至"待修复"状态
```

**暂缓机制**:
- 依赖其他问题 → 标记 ⏸️ 暂缓
- 放入 issue-todo.md 的"暂缓问题"部分
- 依赖解决后，立即移至"待修复问题"

### 3. 批次修复策略

**批次规则**:
- ✅ 每批 ≤5 个问题
- ✅ 优先底层问题（阻塞数多）
- ✅ 相关问题同批
- ✅ 按依赖树从底到表

**批次选择示例**:
```
批次 1: 底层架构问题
- ISSUE-010: Redis 连接池 (阻塞 3 个)
- ISSUE-015: 错误处理机制 (阻塞 2 个)

批次 2: 被解除阻塞的问题
- ISSUE-001: 账户列表慢 (依赖 ISSUE-010 ✅)
- ISSUE-005: API Key 验证超时 (依赖 ISSUE-010 ✅)
- ISSUE-002: 错误信息不清 (依赖 ISSUE-015 ✅)

批次 3: 独立问题
- ISSUE-030: 登录页样式
- ISSUE-031: 统计图表
```

---

## 📖 详细操作指南

### 操作 1: 记录新问题

**步骤**:
1. 打开 `issue-todo.md`
2. 复制问题模板
3. 填写基本信息:
   - 重现步骤
   - 预期/实际行为
   - 错误信息
   - 相关接口
4. **进行根因分析**（重要！）:
   - 追问 5 次"为什么"
   - 确定根因类型
   - 识别依赖关系
   - 列出阻塞问题
5. 确定状态:
   - 有依赖 → ⏸️ 暂缓 → 放入"暂缓问题"
   - 无依赖 → 🔴 待修复 → 放入"待修复问题"
6. 更新依赖树可视化
7. 更新统计信息

**示例**:
```markdown
#### ISSUE-050 - 账户列表加载超过 5 秒

**优先级**: P1
**模块**: 账户管理
**状态**: ⏸️ 暂缓
**发现时间**: 2025-11-02
**发现方式**: UI 漫游测试

**重现步骤**:
1. 登录管理界面
2. 点击"账户管理"
3. 观察加载时间

**预期行为**:
- 应该在 1 秒内加载完成

**实际行为**:
- 需要 5-8 秒才能显示列表

**🔍 根因分析**:
- **根本原因**: Redis 连接池管理不当导致连接泄漏
  - 为什么 1: Redis 查询慢
  - 为什么 2: 连接池连接数不足
  - 为什么 3: 连接未正确释放
  - 为什么 4: 异步错误路径缺少释放逻辑
  - 为什么 5: 未使用 Rust RAII 模式管理连接
- **根因类型**: 🏗️ 架构问题
- **依赖问题**:
  - ⏸️ 依赖 ISSUE-010: 需要先修复 Redis 连接池
- **影响范围**: 所有 Redis 查询操作
```

### 操作 2: 开始修复批次

**步骤**:
1. 打开 `issue-todo.md`
2. 查看依赖树，识别底层问题
3. 选择 ≤5 个问题组成批次:
   - 优先选择阻塞问题数多的
   - 确认所有问题无未解决依赖
4. 打开 `issue-doing.md`
5. **复制问题完整内容**到 issue-doing.md
6. 添加"修复进度"清单
7. 从 issue-todo.md 删除已移动的问题
8. 更新两个文件的统计信息
9. 开始修复第一个问题

**批次信息填写**:
```markdown
### 批次信息

**批次编号**: 1
**批次主题**: 底层架构问题修复
**开始时间**: 2025-11-02
**计划问题数**: 2/5
**完成进度**: 0/2 (0%)

**批次目标**:
- [ ] 修复所有计划问题
- [ ] 所有单元测试通过
- [ ] 所有集成测试通过
- [ ] 接口文档已更新
- [ ] 集成测试已补充
- [ ] UI 回归测试通过
```

### 操作 3: 修复单个问题

**在 issue-doing.md 中跟踪**:
1. 更新修复进度:
   ```markdown
   **修复进度**:
   - [x] 根因分析完成
   - [x] 编写失败的集成测试
   - [ ] 修复 Rust 代码 ← 当前步骤
   - [ ] 单元测试通过
   - [ ] 集成测试通过
   - [ ] 接口文档更新
   - [ ] UI 回归测试
   ```

2. 记录当前进展:
   ```markdown
   **当前进展**:
   - 已在 rust/src/redis/client.rs 实现 RAII 模式
   - 正在重构 account_service.rs 中的连接使用
   - 遇到问题: 需要处理 tokio 异步生命周期
   ```

3. 遇到阻塞时:
   - 详细记录技术难点
   - 寻求帮助或调研
   - 必要时标记 ⏸️ 暂缓，移回 issue-todo.md

### 操作 4: 完成问题修复

**步骤**:
1. 确认该问题的所有修复进度完成
2. 运行完整测试套件
3. 进行 UI 回归测试
4. 打开 `issue-done.md`
5. **复制问题到 issue-done.md**
6. 添加修复信息:
   - 修复方案
   - 技术细节（代码片段）
   - 修改的文件和行号
   - 测试文件
   - Git 提交信息
   - 验证结果
   - 经验总结
7. 从 issue-doing.md 删除该问题
8. 更新两个文件的统计信息

**修复信息示例**:
```markdown
**修复方案**:
- **修改文件**:
  - `rust/src/redis/client.rs:45-120`: 重构连接池管理
  - `rust/src/services/account_service.rs:78`: 修正连接使用
- **测试文件**:
  - `rust/tests/redis_connection_pool_test.rs`: 新增连接池测试
- **接口文档**: 无变更

**技术细节**:
```rust
// 修复前
let mut conn = pool.get().await?;
// 可能泄漏

// 修复后
let result = {
    let mut conn = pool.get().await?;
    perform_operation(&mut conn).await
}; // 连接自动归还
result
```

**修复提交**:
```
commit: abc123def
message: fix: properly manage Redis connection pool lifecycle

Closes ISSUE-010
Unblocks ISSUE-001, ISSUE-005, ISSUE-008
```

**验证结果**:
- ✅ 单元测试通过: 15/15
- ✅ 集成测试通过: 8/8
- ✅ 压力测试: 1000 req/s 稳定
- ✅ UI 回归测试通过

**经验总结**:
- Rust RAII 模式完美解决资源管理
- 异步代码中的生命周期需要特别注意
- 集成测试应包含并发场景
```

### 操作 5: 完成整个批次

**步骤**:
1. 确认批次中所有问题都已移至 issue-done.md
2. 确认批次完成检查清单全部勾选:
   - 代码质量 (clippy, fmt)
   - 测试覆盖
   - 文档同步
   - UI 验证
3. **处理被阻塞的问题**:
   - 打开 issue-todo.md
   - 查看此批次解除了哪些问题的阻塞
   - 将被阻塞问题从"暂缓"移至"待修复"
   - 更新依赖树
4. 更新所有文件的统计信息
5. 在 issue-done.md 添加批次总结
6. 选择下一个批次继续修复

**批次总结示例**:
```markdown
### 批次 1: 底层架构问题修复

**完成时间**: 2025-11-02
**涉及问题**: ISSUE-010, ISSUE-015
**修复时长**: 2 天
**测试结果**: ✅ 所有测试通过
**文档更新**: ✅ 接口文档已更新

**批次总结**:
- 解决了 Redis 连接池管理问题
- 统一了错误处理机制
- 提升了整体性能 30%

**解除阻塞**:
- ISSUE-001, ISSUE-005, ISSUE-008 (依赖 ISSUE-010)
- ISSUE-002, ISSUE-006 (依赖 ISSUE-015)
- 共解除 5 个暂缓问题
```

### 操作 6: 管理暂缓问题

**定期检查** (建议每天):
1. 打开 issue-todo.md 的"暂缓问题"部分
2. 逐个检查依赖状态:
   - 在 issue-done.md 搜索依赖问题ID
   - 如果依赖问题已完成 → 解除暂缓
3. 将可以恢复的问题移至"待修复问题"
4. 更新恢复条件清单
5. 重新评估优先级
6. 安排到合适的批次

**恢复流程**:
```markdown
# 检查 ISSUE-050 的依赖
依赖: ISSUE-010 (Redis 连接池)

# 在 issue-done.md 搜索 "ISSUE-010"
找到: ✅ ISSUE-010 已于 2025-11-02 完成

# 操作
1. 在 issue-todo.md 中:
   - 将 ISSUE-050 从"暂缓问题"移至"待修复问题"
   - 更新状态: ⏸️ 暂缓 → 🔴 待修复
   - 更新依赖树
2. 重新评估优先级（可能因等待时间而提升）
3. 安排到下一批次
```

---

## 📊 文件职责明细

### issue-todo.md

**主要内容**:
- 依赖树可视化
- 修复优先级矩阵
- 待修复问题（可立即修复）
- 暂缓问题（依赖未解决）
- 问题记录模板
- 统计信息

**维护频率**: 每次发现新问题、开始批次、完成批次时更新

**关键指标**:
- 待修复问题数
- 暂缓问题数
- 底层问题数（优先级高）
- 独立问题数

### issue-doing.md

**主要内容**:
- 当前批次信息
- 进行中问题（≤5个）
- 修复进度跟踪
- 当前进展说明
- 批次完成检查清单

**维护频率**: 每天更新进度，完成问题时立即更新

**关键指标**:
- 批次进度百分比
- 预计完成时间
- 遇到的阻塞

### issue-done.md

**主要内容**:
- 已完成批次记录
- 已修复问题详情
- 修复方案和技术细节
- 经验总结
- 根因分析统计
- 知识库

**维护频率**: 问题完成时添加，定期整理知识库

**关键指标**:
- 总完成问题数
- 按根因类型分布
- 平均修复时间
- 典型修复模式

---

## 🎯 最佳实践

### 1. 根因分析最佳实践

**✅ 做**:
- 追问至少 5 次"为什么"
- 识别架构层面的根本原因
- 明确依赖关系
- 记录影响范围

**❌ 不做**:
- 停留在表面现象
- 急于修复不分析
- 忽略依赖关系
- 孤立看待问题

### 2. 批次管理最佳实践

**✅ 做**:
- 优先修复底层问题
- 控制批次大小 ≤5
- 相关问题同批
- 完成一批开始下一批

**❌ 不做**:
- 同时开多个批次
- 批次过大 (>5)
- 混合无关问题
- 半途而废切换批次

### 3. 文档维护最佳实践

**✅ 做**:
- 实时更新进度
- 详细记录修复方案
- 总结经验教训
- 定期整理知识库

**❌ 不做**:
- 批量更新（信息丢失）
- 省略技术细节
- 忘记更新依赖树
- 缺少统计信息

---

## 🔍 常见问题 FAQ

### Q1: 如何判断是否需要暂缓？

**A**: 使用以下判断标准:
- 问题依赖其他**未解决**的问题 → 暂缓
- 问题依赖**新特性**开发 → 暂缓
- 问题**独立**可修复 → 不暂缓
- 问题依赖的问题**已完成** → 不暂缓

### Q2: 批次中途发现新依赖怎么办？

**A**:
1. 停止修复当前问题
2. 在 issue-todo.md 记录新发现的依赖
3. 将当前问题标记 ⏸️ 暂缓
4. 移回 issue-todo.md 的"暂缓问题"
5. 继续修复批次中的其他问题

### Q3: 问题太多怎么办？

**A**:
1. 聚焦底层问题（阻塞数多的）
2. 优先修复 P0/P1 问题
3. 忽略 P3 问题（除非阻塞P0/P1）
4. 利用依赖树识别关键路径
5. 一个批次接一个，不要并行

### Q4: 如何保持文件同步？

**A**:
使用检查清单:
- [ ] 问题从 todo → doing: 两个文件都更新
- [ ] 问题从 doing → done: 两个文件都更新
- [ ] 解除阻塞: 更新 issue-todo.md 依赖树
- [ ] 每个文件的统计信息都更新
- [ ] Git 提交时包含相关的 issue ID

### Q5: 如何利用 issue-done.md 知识库？

**A**:
1. 遇到类似问题时搜索关键词
2. 查看根因类型分布，识别系统性问题
3. 参考典型修复模式
4. 学习最佳实践和经验教训
5. 定期回顾，避免重复问题

---

## 📚 参考资源

- **CLAUDE.md**: 项目整体工作流程
- **docs/guides/api-reference.md**: 接口文档
- **docs/architecture/testing.md**: 测试指南
- **rust/tests/**: 集成测试示例

---

**版本历史**:
- v2.0 (2025-11-02): 三文件分离式系统
- v1.0: 单文件系统 (已废弃)
